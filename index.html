<!DOCTYPE html>
<html>

<head>
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-W5V9DL3');</script>
    <!-- End Google Tag Manager -->
    <title>转租信息</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- <link href="/test/video-js.css" rel="stylesheet" /> -->
    <link href="https://cdn.staticfile.org/video.js/8.5.0/video-js.min.css" rel="stylesheet" />
    <style>
        body {
            background-color: #f0f0f0;
            font-size: 14px;
            padding-left: 1%;
            padding-right: 1%;
        }

        .module {
            margin-bottom: 10px;
            background-color: #ffffff;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            margin-bottom: 5px;
            font-size: 14px;
        }

        p {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        p span {
            margin-right: 30px;
        }

        .map-address {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0px;
            /* margin-bottom: 3px; */
        }

        .map-address span {
            cursor: pointer;
        }

        #map {
            width: 100%;
            height: 300px;
        }

        .qr-code {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .qr-code img {
            width: 150px;
            height: 150px;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: 2%;
            /* height: 8%; */
            /* padding-right: 24px;
            padding-left: 24px;
            padding-top: 6px;
            padding-bottom: 6px;
            position: relative; */
        }


        .copy-button {
            display: inline-block;
            /* margin-top: 10px;
            margin-bottom: 20px; */
            /* margin: auto; */
            padding: 8px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 17px;
            width: 100px;
            /* height: 40px; */
        }

        img {
            -webkit-touch-callout: none;
        }



        /* #qrcode {
            max-width: 300px;
            margin: 0 auto;
        } */

        /* #qrcode2 { */
        /* padding-top: 15px;
            padding-bottom: 15px;
            max-width: 300px; */
        /* margin: 0 auto; */
        /* width: 200px; */
        /* height: 200px; */
        /* display: flex;
            flex-direction: column;
            align-items: center; */
        /* } */
        ul {
            padding: 0;
            list-style: none;
            margin: 0px;
        }

        .swiper-list {
            /* width: 98%; */
            height: 360px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            display: none;
            background-color: #ffffff;
            justify-content: center;
            align-items: center;

            margin-bottom: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            /* background-color: #ffffff; */
            /* padding: 15px; */
        }

        .swiper-main {
            height: 100%;
            position: relative;
            overflow: hidden;
            justify-content: center;
        }

        .swiper-item {
            height: 100%;
            display: inline;
            position: absolute;
        }

        img {
            width: auto;
            height: 360px;
            display: block;
            max-width: 100%;
        }

        .swiper-spot {
            width: 100%;
            height: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            bottom: 10px;
        }

        .swiper-spot .spot-item {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background-color: #ccc;
            margin-left: 10px;
        }

        .swiper-spot .spot-item:nth-of-type(1) {
            margin-left: 0;
        }

        .leftBtn {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 45px;
            height: 45px;
        }

        .rightBtn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 45px;
            height: 45px;
        }

        li a {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .vid-module {
            margin-bottom: 10px;
            background-color: #ffffff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
    </style>

</head>

<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W5V9DL3"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div id="content">
        <div id="vid" class="vid-module" style="display: none;">
            <!-- <video id="my-video" class="video-js" width="627" height="258" poster=""
                data-setup='{"controls": true, "autoplay": true, "preload": "auto"}'>
                <source
                    src="https://detail.fzchats.uk/?proxyUrl=http://sns-video-hw.xhscdn.com/stream/110/258/01e48912e72aa2dd0103710388b771f040_258.mp4"
                    type="video/mp4" />
                <p class="vjs-no-js">
                    To view this video please enable JavaScript, and consider upgrading to a
                    web browser that
                    <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
                </p>
            </video> -->
        </div>

        <div id="pics" class="swiper-list"></div>
        <div id="loc" class="module">
            <h2>地图</h2>
            <div class="map-address">
                <p id="poiaddress" style="padding-bottom: 5px;">

                </p>
                <p>
                    <svg onclick=mapDetail() t="1686494247641" class="icon" viewBox="0 0 1024 1024" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" p-id="2378" width="24" height="24">
                        <path
                            d="M688.96 517.12a31.872 31.872 0 0 0-7.68-12.224L455.04 278.592a32 32 0 0 0-45.248 0l-22.592 22.656a32 32 0 0 0 0 45.248l186.752 186.816L391.04 716.16a32 32 0 0 0 0 45.248l22.656 22.656a32 32 0 0 0 45.248 0l226.24-226.304a32 32 0 0 0 3.776-40.768z"
                            fill="#2c2c2c" p-id="2379"></path>
                    </svg>
                </p>
            </div>
            <div id="map"></div>
        </div>
        <div class="module">
            <h2>概况</h2>
            <p><span>房源类型</span><span id="roomType"></span></p>
            <p><span>房源位置</span><span id="position1"></span></p>
            <p><span>房源价格</span><span id="price"></span></p>
            <p><span>合同甲方</span><span id="party"></span></p>
            <p><span>剩余租期</span><span id="endtime"></span></p>
            <p><span>能否短租</span><span id="rental"></span></p>
            <p><span>付款方式</span><span id="pay"></span></p>
            <p><span>附近交通</span><span id="position2"></span></p>
        </div>
        <div class="module">
            <h2>描述</h2>
            <p id="rentDesc" style="white-space: pre-line;">
                这种类型的房间有一张单间床，例如可以转换成床的沙发。部分一室公寓配有额外的床铺。其他房间空间更大：工作室房间可以像家具齐全的公寓，这意味着它将有一个小厨房。请与酒店联系以了解有关其单间客房的更多信息。</p>
        </div>
        <div class="module">
            <h2>联系方式<span style="font-size: 12px; color: red;">(长按识别)</span></h2>
            <!-- <div style="  background-color: #f0f0f0;"> -->

            <div class="qrcode" id="qrcode2"></div>

            <div id="qrcode" style="display: none;"></div>

        </div>
    </div>
    <script src="/qrcode.min.js"></script>
    <script src="/slider.js"></script>
    <!-- <script src="/test/video.min.js"></script> -->
    <script src="https://cdn.staticfile.org/video.js/8.5.0/video.min.js"></script>
    <script src="https://map.qq.com/api/js?v=2.exp&key=4RWBZ-F2UWV-KATP5-UD3YA-YFYI5-FDBYJ"></script>
    <script>
        var houseTypes = ["未提及", "单间", "次卧", "主卧", "一居室", "两居室", "三居室", "四居室"]
        var mapUrl;
        function iosAgent() {
            return navigator.userAgent.match(/(iPhone|iPod|iPad);?/i);
        }
        function isInEmbed() {
            return window !== window.parent;
        }



        function mapDetail() {
            window.location.href = mapUrl;
        }
        // function noteDetail() {
        //     window.location.href = noteDetailUrl;
        // }
        // JavaScript代码，用于获取和处理URL参数
        function getQueryParams() {
            var params = {};
            var queryString = window.location.search.substring(1);
            var pairs = queryString.split('&');

            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i].split('=');
                var key = decodeURIComponent(pair[0]);
                var value = decodeURIComponent(pair[1]);
                params[key] = value;
            }
            return params;
        }
        function convertCanvasToImage(canvas) {
            //新建Image对象
            var image = new Image();
            // canvas.toDataURL 返回的是一串Base64编码的URL
            image.src = canvas.toDataURL("image/png");
            image.id = 'qrcodeImg';
            return image;
        }

        function dateFormat(str) {
            var dateArray = str.split("/")
            if (dateArray[1].length == 1) {
                dateArray[1] = "0" + dateArray[1]
            }
            if (dateArray[2].length == 1) {
                dateArray[2] = "0" + dateArray[2]
            }
            return dateArray[0] + "-" + dateArray[1] + "-" + dateArray[2]

        }

        // 示例：获取参数并进行处理
        window.onload = function () {
            var queryParams = getQueryParams();
            dataStr = queryParams['data'];
            if (dataStr) {
                let data = JSON.parse(dataStr);

                var price = data['price'];
                document.getElementById("price").innerHTML = 0 + ' RMB/月'
                if (price) {
                    document.getElementById("price").innerHTML = price + ' RMB/月'
                }
                var roomType = data['roomType'];
                document.getElementById("roomType").innerHTML = houseTypes[0]
                if (roomType) {
                    document.getElementById("roomType").innerHTML = houseTypes[roomType]
                }
                var position1
                var position2
                var position3
                var position4
                var position5
                if (data['positions']) {
                    let positions = data['positions']
                    let length = positions.length;
                    if (length > 0) {
                        position1 = positions[0];
                    }
                    if (length > 1) {
                        position2 = positions[1];
                    }
                    if (length > 2) {
                        position3 = positions[2];
                    }
                    if (length > 3) {
                        position4 = positions[3];
                    }
                    if (length > 4) {
                        position5 = positions[4];
                    }
                }

                if (position1) {
                    document.getElementById("position1").innerHTML = position1
                }
                if (position2) {
                    document.getElementById("position2").innerHTML = position2
                }

                var name = data['name'];
                if (name) {
                    document.title = name + "的转租信息";
                }
                var mediaType = data['media_type']
                var media = data['media']
                if (mediaType && media && mediaType === "normal" && media.length > 0) {
                    //展示轮播
                    document.getElementById("pics").style.display = "block"
                    let imgArr = media.map((imgPath) => {
                        return {
                            url: '#',
                            imgPath:  "https://sns-img-hw.xhscdn.com"+new URL(imgPath).pathname+"?imageView2/2/w/540/format/jpg"
                            // imgPath:  imgPath+"?imageView2/2/w/540/format/jpg"
                            
                        };
                    });
                    new Swiper({
                        imgArr: imgArr, // 图片数组
                        aniTIme: 1000, // 动画执行的时间
                        intervalTime: 6000000, // 图片停留的时间
                        autoplay: false // 是否自动播放
                    }).init();
                }
                if (mediaType && media && mediaType === "video" && media.length > 0) {
                    // let imgArr = media.map((imgPath) => {
                    //    return "https://detail.fzchats.uk/?proxyUrl=" + imgPath
                    // });
                    // var vedioUrl="http://sns-video-qc.xhscdn.com"+new URL(media[0]).pathname
                    var vedioUrl="https://detail.fzchats.uk/?proxyUrl=" +media[0];
                    //展示视频
                    var vidElement = document.getElementById("vid")
                    vidElement.style.display = "block"
                    vidElement.innerHTML = '<video id="my-player" class="video-js" controls preload="auto"  > <source src="' +vedioUrl + '" type="video/mp4"/> </video>'
                    var wid=vidElement.offsetWidth
                    let options = { width: wid, height: 264 ,loop:true }
                    if (media.length > 1){
                        options.poster="https://sns-img-hw.xhscdn.com"+new URL(media[1]).pathname+"?imageView2/2/w/540/format/jpg"
                        // options.poster=imgArr[1]
                    }
                    videojs('my-player', options, function () {
                        videojs.log('播放器准备好了!');
                        // 最新的浏览器一般禁止video自动播放，直接调用play()会报错。只有用户在页面上操作后或者在video标签上添加muted（静音）属性，才能调用play函数。
                        // this.play();
                    });

                }
                var endtime = data['endtime']
                document.getElementById("endtime").innerHTML = dateFormat(new Date().toLocaleDateString()) + '到期'
                if (endtime) {
                    document.getElementById("endtime").innerHTML = dateFormat(new Date(endtime * 1000).toLocaleDateString()) + '到期'
                }
                var rental = data['rental']
                document.getElementById("rental").innerHTML = '不能'
                if (rental) {
                    if (rental == 1) {
                        document.getElementById("rental").innerHTML = '能'
                    }
                }
                var party = data['party']
                if (party) {
                    document.getElementById("party").innerHTML = party

                }
                var pay = data['pay']
                if (pay) {
                    document.getElementById("pay").innerHTML = pay

                }
                var rentDesc = data['rent_desc']
                if (rentDesc) {
                    document.getElementById("rentDesc").innerHTML = rentDesc
                }
                var lat = data['lat']
                var lng = data['lng']
                var poiaddress = data['poiaddress']
                var poiname = data['poiname']
                var cityname = data['cityname'];
                var qrcodeUrl = data['qrcode']
                if (qrcodeUrl) {
                    if (!qrcodeUrl.startsWith("http")){
                        qrcodeUrl = "https://weixin.qq.com/g/" + qrcodeUrl
                    }
                    // document.getElementById('qrcode').style.display = 'none';
                    var qrcode = new QRCode("qrcode", {
                        text: 'your content',
                        width: 256,
                        height: 256,
                        colorDark: '#0c6eb7',
                        colorLight: '#ffffff',
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    qrcode.makeCode(qrcodeUrl);
                    var canvas = document.getElementsByTagName('canvas')[0];
                    var img = this.convertCanvasToImage(canvas);
                    img.style.padding = "20px";
                    img.style.width = "175px";
                    img.style.height = "175px";
                    var element = document.getElementById("qrcode2");
                    element.append(img);
                    element.style.display = "flex";
                    element.style.flexDirection = "column";
                    element.style.alignItems = "center";
                    if (iosAgent() && isInEmbed()) {
                        //被嵌入时,ios端传递数据到父页面
                        img.addEventListener('touchstart', function (e) {
                            // console.log("111111111111111111")
                            // 执行 touchstart 事件的处理逻辑
                            window.parent.postMessage(JSON.stringify({ status: 1, url: img.src }), '*')
                        }, false);

                        img.addEventListener('touchend', function (e) {
                            // console.log("22222")
                            // 执行 touchend 事件的处理逻辑
                            window.parent.postMessage(JSON.stringify({ status: 2 }), '*')
                        }, false);
                    }
                }
                if (lat && lng) {
                    var map = new qq.maps.Map(document.getElementById('map'), {
                        center: new qq.maps.LatLng(lat, lng), // 设置地图的中心点为上海
                        zoom: 13, // 设置地图的缩放级别
                        disableDefaultUI: true
                    });
                    // 创建一个标记并添加到地图上
                    var marker = new qq.maps.Marker({
                        position: new qq.maps.LatLng(lat, lng), // 标记的位置
                        map: map // 将标记添加到之前创建的map对象上
                    });
                    mapUrl = 'http://apis.map.qq.com/tools/poimarker?type=0&marker=coord:' + lat + ',' + lng + ';title:' + poiname + ';addr:' + poiaddress + '&key=UXFBZ-XLWCZ-4SBXH-7WULJ-W45P5-2IBFF&referer=myapp'
                }
                //继续赋值
                if (poiaddress) {
                    document.getElementById("poiaddress").innerHTML = poiaddress
                }


            } else {
                // document.getElementById("topic1").innerHTML = "1.长按二维码"
                // document.getElementById("topic2").innerHTML = "2.选择打开对方名片"
                // document.getElementById("topic3").innerHTML = "3.添加好友开始咨询"
                location.href = "https://fzchats.uk/qrcb"
                return
            }

        };

    </script>
</body>

</html>