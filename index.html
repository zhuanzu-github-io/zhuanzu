<!DOCTYPE html>
<html>

<head>
    <title>页面</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
        body {
            background-color: #f0f0f0;
            font-size: 14px;
            padding-left: 1%;
            padding-right: 1%;
        }

        .module {
            margin-bottom: 10px;
            background-color: #ffffff;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            margin-bottom: 5px;
            font-size: 14px;
        }

        p {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        p span {
            margin-right: 30px;
        }

        .map-address {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0px;
            /* margin-bottom: 3px; */
        }

        .map-address span {
            cursor: pointer;
        }

        #map {
            width: 100%;
            height: 300px;
        }

        .qr-code {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .qr-code img {
            width: 150px;
            height: 150px;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding-right: 24px;
            padding-left: 24px;
            padding-top: 6px;
            padding-bottom: 6px;
            position: relative;
        }


        .copy-button {
            display: inline-block;
            margin: auto 10px;
            padding: 8px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            margin-top: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 18px;
            width: 100px;
        }

       


        /* #qrcode {
            max-width: 300px;
            margin: 0 auto;
        } */

        /* #qrcode2 { */
        /* padding-top: 15px;
            padding-bottom: 15px;
            max-width: 300px; */
        /* margin: 0 auto; */
        /* width: 200px; */
        /* height: 200px; */
        /* display: flex;
            flex-direction: column;
            align-items: center; */
        /* } */
    </style>

</head>

<body>
    <div id="tencentMap" style="width: 100vw;height: 95vh;display: none;position: fixed;">
        <!-- <iframe  id="mapPage" width="100%" height="100%" class="iframeElement" frameborder=0
            src="http://xhslink.com/I74q8q">
        </iframe> -->
        <!-- <embed id="mapPage" type="text/html"  width="100%" height="92%" >
        <div class="container">
            <button class="copy-button" onclick="closeMap()">关闭</button>
        </div> -->
    </div>
    <div id="content">
        <div class="module">
            <h2>地图</h2>
            <div class="map-address">
                <p id="poiaddress" style="padding-bottom: 5px;">
                    上海长宁中山公园定西路
                </p>
                <p>
                    <svg onclick=mapDetail() t="1686494247641" class="icon" viewBox="0 0 1024 1024" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" p-id="2378" width="24" height="24">
                        <path
                            d="M688.96 517.12a31.872 31.872 0 0 0-7.68-12.224L455.04 278.592a32 32 0 0 0-45.248 0l-22.592 22.656a32 32 0 0 0 0 45.248l186.752 186.816L391.04 716.16a32 32 0 0 0 0 45.248l22.656 22.656a32 32 0 0 0 45.248 0l226.24-226.304a32 32 0 0 0 3.776-40.768z"
                            fill="#2c2c2c" p-id="2379"></path>
                    </svg>
                </p>
            </div>
            <div id="map"></div>
        </div>
        <div class="module">
            <h2>概况</h2>
            <p><span>房源类型</span><span id="roomType"></span></p>
            <p><span>房源位置</span><span id="position1"></span></p>
            <p><span>房源价格</span><span id="price"></span></p>
            <p><span>合同甲方</span><span id="party"></span></p>
            <p><span>剩余租期</span><span id="endtime"></span></p>
            <p><span>能否短租</span><span id="rental"></span></p>
            <p><span>付款方式</span><span id="pay"></span></p>
            <p><span>附近交通</span><span id="position2"></span></p>
            <p><span onclick=showIframe() style="color:coral;font-size: 14px;">点击查看视频图文详情</span></p>
        </div>
        <div class="module">
            <h2>描述</h2>
            <p id="rentDesc" style="white-space: pre-line;">
                这种类型的房间有一张单间床，例如可以转换成床的沙发。部分一室公寓配有额外的床铺。其他房间空间更大：工作室房间可以像家具齐全的公寓，这意味着它将有一个小厨房。请与酒店联系以了解有关其单间客房的更多信息。</p>
        </div>
        <div class="module">
            <h2>联系方式</h2>
            <!-- <div style="  background-color: #f0f0f0;"> -->

            <div class="qrcode" id="qrcode2"></div>

            <div id="qrcode" style="display: none;"></div>

        </div>
    </div>
    <script src="qrcode.min.js"></script>
    <script src="https://map.qq.com/api/js?v=2.exp&key=UXFBZ-XLWCZ-4SBXH-7WULJ-W45P5-2IBFF"></script>
    <script>
        var houseTypes = ["未提及", "单间", "次卧", "主卧", "一居室", "两居室", "三居室", "四居室"]
        var mapUrl;
        function showIframe() {
            var mapElement = document.getElementById('tencentMap');
            mapElement.style.display = "block"
            document.getElementById('content').style.display = "none";

        }

        function closeMap() {
            var mapElement = document.getElementById('tencentMap');
            mapElement.style.display = "none";
            document.getElementById('content').style.display = "block";
        }

        function mapDetail() {
            window.location.href = mapUrl;
        }
        // function noteDetail() {
        //     window.location.href = noteDetailUrl;
        // }
        // JavaScript代码，用于获取和处理URL参数
        function getQueryParams() {
            var params = {};
            var queryString = window.location.search.substring(1);
            var pairs = queryString.split('&');

            for (var i = 0; i < pairs.length; i++) {
                var pair = pairs[i].split('=');
                var key = decodeURIComponent(pair[0]);
                var value = decodeURIComponent(pair[1]);
                params[key] = value;
            }
            return params;
        }
        function convertCanvasToImage(canvas) {
            //新建Image对象
            var image = new Image();
            // canvas.toDataURL 返回的是一串Base64编码的URL
            image.src = canvas.toDataURL("image/png");
            image.id = 'qrcodeImg';
            return image;
        }

        function dateFormat(str) {
            var dateArray = str.split("/")
            if (dateArray[1].length == 1) {
                dateArray[1] = "0" + dateArray[1]
            }
            if (dateArray[2].length == 1) {
                dateArray[2] = "0" + dateArray[2]
            }
            return dateArray[0] + "-" + dateArray[1] + "-" + dateArray[2]

        }

        // 示例：获取参数并进行处理
        window.onload = function () {
            var queryParams = getQueryParams();
            dataStr = queryParams['data'];
            if (dataStr) {
                let data = JSON.parse(dataStr);

                var price = data['price'];
                if (price) {
                    document.getElementById("price").innerHTML = price + ' RMB/月'
                }
                var roomType = data['roomType'];
                if (roomType) {
                    document.getElementById("roomType").innerHTML = houseTypes[roomType]
                }
                var position1
                var position2
                var position3
                var position4
                var position5
                if (data['positions']) {
                    let positions = data['positions']
                    let length = positions.length;
                    if (length > 0) {
                        position1 = positions[0];
                    }
                    if (length > 1) {
                        position2 = positions[1];
                    }
                    if (length > 2) {
                        position3 = positions[2];
                    }
                    if (length > 3) {
                        position4 = positions[3];
                    }
                    if (length > 4) {
                        position5 = positions[4];
                    }
                }

                if (position1) {
                    document.getElementById("position1").innerHTML = position1
                }
                if (position2) {
                    document.getElementById("position2").innerHTML = position2
                }

                var name = data['name'];
                if (name) {
                    document.title = name + "的转租信息";
                }
                var noteUrl = data['note_url']
                if (noteUrl) {
                    document.getElementById('tencentMap').innerHTML='<embed id="mapPage" src='+noteUrl+' type="text/html"  width="100%" height="92%" > <div class="container"> <button class="copy-button" onclick="closeMap()">关闭</button> </div>'

                }
                var endtime = data['endtime']
                if (endtime) {
                    document.getElementById("endtime").innerHTML = dateFormat(new Date(endtime * 1000).toLocaleDateString()) + '到期'
                }
                var rental = data['rental']
                if (rental) {
                    document.getElementById("rental").innerHTML = '不能'
                    if (rental == 1) {
                        document.getElementById("rental").innerHTML = '能'
                    }
                }
                var party = data['party']
                if (party) {
                    document.getElementById("party").innerHTML = party

                }
                var pay = data['pay']
                if (pay) {
                    document.getElementById("pay").innerHTML = pay

                }
                var rentDesc = data['rent_desc']
                if (rentDesc) {
                    document.getElementById("rentDesc").innerHTML = rentDesc
                }
                var lat = data['lat']
                var lng = data['lng']
                var poiaddress = data['poiaddress']
                var poiname = data['poiname']
                var cityname = data['cityname'];
                var qrcodeUrl = data['qrcode']
                if (qrcodeUrl) {
                    qrcodeUrl = "https://weixin.qq.com/g/" + qrcodeUrl
                    // document.getElementById('qrcode').style.display = 'none';
                    var qrcode = new QRCode("qrcode", {
                        text: 'your content',
                        width: 256,
                        height: 256,
                        colorDark: '#0c6eb7',
                        colorLight: '#ffffff',
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    qrcode.makeCode(qrcodeUrl);
                    var canvas = document.getElementsByTagName('canvas')[0];
                    var img = this.convertCanvasToImage(canvas);
                    img.style.padding = "10px";
                    img.style.width = "175px";
                    img.style.height = "175px";
                    var element = document.getElementById("qrcode2");
                    element.append(img);
                    element.style.display = "flex";
                    element.style.flexDirection = "column";
                    element.style.alignItems = "center";
                }
                if (lat && lng) {
                    var map = new qq.maps.Map(document.getElementById('map'), {
                        center: new qq.maps.LatLng(lat, lng), // 设置地图的中心点为上海
                        zoom: 13, // 设置地图的缩放级别
                        disableDefaultUI: true
                    });
                    // 创建一个标记并添加到地图上
                    var marker = new qq.maps.Marker({
                        position: new qq.maps.LatLng(lat, lng), // 标记的位置
                        map: map // 将标记添加到之前创建的map对象上
                    });
                    mapUrl = 'http://apis.map.qq.com/tools/poimarker?type=0&marker=coord:' + lat + ',' + lng + ';title:' + poiname + ';addr:' + poiaddress + '&key=UXFBZ-XLWCZ-4SBXH-7WULJ-W45P5-2IBFF&referer=myapp'
                }
                //继续赋值
                if (poiaddress) {
                    document.getElementById("poiaddress").innerHTML = poiaddress
                }


            } else {
                // document.getElementById("topic1").innerHTML = "1.长按二维码"
                // document.getElementById("topic2").innerHTML = "2.选择打开对方名片"
                // document.getElementById("topic3").innerHTML = "3.添加好友开始咨询"
                location.href = "https://fzchats.uk/qrcb"
                return
            }

        };

    </script>
</body>

</html>